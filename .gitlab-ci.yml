image: alpine:latest
before_script:
  - apk add --no-cache openssh-client # Install SSH client in the Docker image
  - eval $(ssh-agent -s) # Start the SSH agent
  - chmod 400 "$SSH_PRIVATE_KEY"
  - ssh-add "$SSH_PRIVATE_KEY"
  ##
  ## Create the SSH directory and give it the right permissions
  ##
  - mkdir -p ~/.ssh
  - chmod 700 ~/.ssh
  - ssh-keyscan server.icstudio.online >> ~/.ssh/known_hosts

deploy:
  stage: deploy
  only:
    - master
  script: 
    - ssh www-root@server.icstudio.online "bash batyevka.sh" -vvv
    - echo "Deployed"

deploy-dev:
  stage: deploy
  only:
    - testing
  script: 
    - ssh www-root@server.icstudio.online "bash batyevka-dev.sh" -vvv
    - echo "Deployed"